{"ast":null,"code":"// In useGoogleAuth.js, update the authenticate function\nconst authenticate = async () => {\n  try {\n    setIsLoading(true);\n    setError(null);\n    const response = await cloudStorageAPI.getAuthUrl();\n    const authUrl = response.data.authUrl;\n    console.log('üîó Opening auth URL:', authUrl);\n    const authPromise = new Promise((resolve, reject) => {\n      const popup = window.open(authUrl, 'google-auth', 'width=600,height=700,scrollbars=yes,resizable=yes,left=' + Math.round(window.screen.width / 2 - 300) + ',top=' + Math.round(window.screen.height / 2 - 350));\n      if (!popup) {\n        reject(new Error('Popup blocked. Please allow popups for this site.'));\n        return;\n      }\n\n      // Check popup URL for errors\n      const checkPopup = setInterval(() => {\n        try {\n          if (popup.closed) {\n            clearInterval(checkPopup);\n            return;\n          }\n\n          // Try to read the URL for error detection\n          const currentUrl = popup.location.href;\n          console.log('üîç Popup URL changed:', currentUrl);\n\n          // Check for error in URL\n          if (currentUrl.includes('error=')) {\n            clearInterval(checkPopup);\n            const urlParams = new URLSearchParams(currentUrl.split('?')[1]);\n            const error = urlParams.get('error');\n            const errorDescription = urlParams.get('error_description');\n            popup.close();\n            reject(new Error(`OAuth Error: ${error} - ${errorDescription}`));\n          }\n        } catch (e) {\n          // Cross-origin error is expected when on Google's domain\n          if (!e.message.includes('cross-origin')) {\n            console.log('Popup check error:', e.message);\n          }\n        }\n      }, 1000);\n      const messageHandler = event => {\n        if (event.origin !== window.location.origin) return;\n        clearInterval(checkPopup);\n        if (event.data.type === 'GOOGLE_AUTH_SUCCESS') {\n          window.removeEventListener('message', messageHandler);\n          resolve({\n            accessToken: event.data.accessToken,\n            expiry: event.data.expiry\n          });\n        } else if (event.data.type === 'GOOGLE_AUTH_ERROR') {\n          window.removeEventListener('message', messageHandler);\n          reject(new Error(event.data.error || 'Authentication failed'));\n        }\n      };\n      window.addEventListener('message', messageHandler);\n      const checkClosed = setInterval(() => {\n        if (popup.closed) {\n          clearInterval(checkClosed);\n          clearInterval(checkPopup);\n          window.removeEventListener('message', messageHandler);\n          reject(new Error('Authentication cancelled by user'));\n        }\n      }, 1000);\n      setTimeout(() => {\n        clearInterval(checkClosed);\n        clearInterval(checkPopup);\n        window.removeEventListener('message', messageHandler);\n        if (!popup.closed) {\n          popup.close();\n        }\n        reject(new Error('Authentication timeout'));\n      }, 300000);\n    });\n    const {\n      accessToken,\n      expiry\n    } = await authPromise;\n    localStorage.setItem('google_access_token', accessToken);\n    localStorage.setItem('google_token_expiry', expiry.toString());\n    setAccessToken(accessToken);\n    setIsAuthenticated(true);\n  } catch (error) {\n    console.error('‚ùå Auth error details:', error);\n    setError(error.message || 'Authentication failed');\n  } finally {\n    setIsLoading(false);\n  }\n};","map":{"version":3,"names":["authenticate","setIsLoading","setError","response","cloudStorageAPI","getAuthUrl","authUrl","data","console","log","authPromise","Promise","resolve","reject","popup","window","open","Math","round","screen","width","height","Error","checkPopup","setInterval","closed","clearInterval","currentUrl","location","href","includes","urlParams","URLSearchParams","split","error","get","errorDescription","close","e","message","messageHandler","event","origin","type","removeEventListener","accessToken","expiry","addEventListener","checkClosed","setTimeout","localStorage","setItem","toString","setAccessToken","setIsAuthenticated"],"sources":["D:/pdf demo/frontend/src/hooks/useGoogleAuth.js"],"sourcesContent":["// In useGoogleAuth.js, update the authenticate function\r\nconst authenticate = async () => {\r\n  try {\r\n    setIsLoading(true);\r\n    setError(null);\r\n\r\n    const response = await cloudStorageAPI.getAuthUrl();\r\n    const authUrl = response.data.authUrl;\r\n    \r\n    console.log('üîó Opening auth URL:', authUrl);\r\n\r\n    const authPromise = new Promise((resolve, reject) => {\r\n      const popup = window.open(\r\n        authUrl,\r\n        'google-auth',\r\n        'width=600,height=700,scrollbars=yes,resizable=yes,left=' + \r\n        Math.round(window.screen.width / 2 - 300) + ',top=' + \r\n        Math.round(window.screen.height / 2 - 350)\r\n      );\r\n\r\n      if (!popup) {\r\n        reject(new Error('Popup blocked. Please allow popups for this site.'));\r\n        return;\r\n      }\r\n\r\n      // Check popup URL for errors\r\n      const checkPopup = setInterval(() => {\r\n        try {\r\n          if (popup.closed) {\r\n            clearInterval(checkPopup);\r\n            return;\r\n          }\r\n          \r\n          // Try to read the URL for error detection\r\n          const currentUrl = popup.location.href;\r\n          console.log('üîç Popup URL changed:', currentUrl);\r\n          \r\n          // Check for error in URL\r\n          if (currentUrl.includes('error=')) {\r\n            clearInterval(checkPopup);\r\n            const urlParams = new URLSearchParams(currentUrl.split('?')[1]);\r\n            const error = urlParams.get('error');\r\n            const errorDescription = urlParams.get('error_description');\r\n            popup.close();\r\n            reject(new Error(`OAuth Error: ${error} - ${errorDescription}`));\r\n          }\r\n        } catch (e) {\r\n          // Cross-origin error is expected when on Google's domain\r\n          if (!e.message.includes('cross-origin')) {\r\n            console.log('Popup check error:', e.message);\r\n          }\r\n        }\r\n      }, 1000);\r\n\r\n      const messageHandler = (event) => {\r\n        if (event.origin !== window.location.origin) return;\r\n\r\n        clearInterval(checkPopup);\r\n\r\n        if (event.data.type === 'GOOGLE_AUTH_SUCCESS') {\r\n          window.removeEventListener('message', messageHandler);\r\n          resolve({\r\n            accessToken: event.data.accessToken,\r\n            expiry: event.data.expiry\r\n          });\r\n        } else if (event.data.type === 'GOOGLE_AUTH_ERROR') {\r\n          window.removeEventListener('message', messageHandler);\r\n          reject(new Error(event.data.error || 'Authentication failed'));\r\n        }\r\n      };\r\n\r\n      window.addEventListener('message', messageHandler);\r\n\r\n      const checkClosed = setInterval(() => {\r\n        if (popup.closed) {\r\n          clearInterval(checkClosed);\r\n          clearInterval(checkPopup);\r\n          window.removeEventListener('message', messageHandler);\r\n          reject(new Error('Authentication cancelled by user'));\r\n        }\r\n      }, 1000);\r\n\r\n      setTimeout(() => {\r\n        clearInterval(checkClosed);\r\n        clearInterval(checkPopup);\r\n        window.removeEventListener('message', messageHandler);\r\n        if (!popup.closed) {\r\n          popup.close();\r\n        }\r\n        reject(new Error('Authentication timeout'));\r\n      }, 300000);\r\n    });\r\n\r\n    const { accessToken, expiry } = await authPromise;\r\n    \r\n    localStorage.setItem('google_access_token', accessToken);\r\n    localStorage.setItem('google_token_expiry', expiry.toString());\r\n    \r\n    setAccessToken(accessToken);\r\n    setIsAuthenticated(true);\r\n\r\n  } catch (error) {\r\n    console.error('‚ùå Auth error details:', error);\r\n    setError(error.message || 'Authentication failed');\r\n  } finally {\r\n    setIsLoading(false);\r\n  }\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}