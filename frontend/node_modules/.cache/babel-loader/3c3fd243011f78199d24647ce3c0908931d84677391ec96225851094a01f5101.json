{"ast":null,"code":"var _jsxFileName = \"D:\\\\pdf demo\\\\frontend\\\\src\\\\pages\\\\PDFViewer.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useCallback, useEffect } from 'react';\nimport { useParams, Link } from 'react-router-dom';\nimport { useQuery, useMutation, useQueryClient } from 'react-query';\nimport { Document, Page, pdfjs } from 'react-pdf';\nimport toast from 'react-hot-toast';\nimport { pdfAPI, highlightAPI } from '../services/api';\nimport { v4 as uuidv4 } from 'uuid';\n\n// Set up PDF.js worker\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\npdfjs.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.min.js`;\nconst PDFViewer = () => {\n  _s();\n  const {\n    uuid\n  } = useParams();\n  const [numPages, setNumPages] = useState(null);\n  const [pageNumber, setPageNumber] = useState(1);\n  const [scale, setScale] = useState(1.0);\n  const [isSelecting, setIsSelecting] = useState(false);\n  const [highlights, setHighlights] = useState([]);\n  const [isCreatingHighlight, setIsCreatingHighlight] = useState(false);\n  const [pageSize, setPageSize] = useState({\n    width: 0,\n    height: 0\n  });\n  const pageContainerRef = useRef(null);\n  const queryClient = useQueryClient();\n\n  // Fetch PDF file as blob\n  const {\n    data: pdfBlob,\n    isLoading: pdfLoading,\n    error: pdfError\n  } = useQuery(['pdf', uuid], () => pdfAPI.get(uuid), {\n    select: response => new Blob([response.data], {\n      type: 'application/pdf'\n    }),\n    enabled: !!uuid,\n    retry: 2\n  });\n\n  // Fetch highlights for this PDF\n  const {\n    data: highlightsData\n  } = useQuery(['highlights', uuid], () => highlightAPI.getByPDF(uuid), {\n    enabled: !!uuid,\n    onSuccess: response => {\n      setHighlights(response.data.highlights || []);\n    },\n    onError: error => {\n      console.error('Failed to fetch highlights:', error);\n      toast.error('Failed to load highlights');\n    }\n  });\n\n  // Create highlight mutation\n  const createHighlightMutation = useMutation(highlightAPI.create, {\n    onSuccess: () => {\n      queryClient.invalidateQueries(['highlights', uuid]);\n      toast.success('Highlight created!');\n      setIsCreatingHighlight(false);\n    },\n    onError: error => {\n      var _error$response, _error$response$data;\n      console.error('Failed to create highlight:', error);\n      toast.error(((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.error) || 'Failed to create highlight');\n      setIsCreatingHighlight(false);\n    }\n  });\n\n  // Delete highlight mutation\n  const deleteHighlightMutation = useMutation(highlightAPI.delete, {\n    onSuccess: () => {\n      queryClient.invalidateQueries(['highlights', uuid]);\n      toast.success('Highlight deleted!');\n    },\n    onError: error => {\n      var _error$response2, _error$response2$data;\n      toast.error(((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.error) || 'Failed to delete highlight');\n    }\n  });\n  const onDocumentLoadSuccess = ({\n    numPages\n  }) => {\n    setNumPages(numPages);\n    console.log('PDF loaded with', numPages, 'pages');\n  };\n  const onPageLoadSuccess = page => {\n    const {\n      width,\n      height\n    } = page.originalWidth ? {\n      width: page.originalWidth,\n      height: page.originalHeight\n    } : {\n      width: page.width,\n      height: page.height\n    };\n    setPageSize({\n      width: width * scale,\n      height: height * scale\n    });\n    console.log('Page loaded:', {\n      width: width * scale,\n      height: height * scale,\n      scale\n    });\n  };\n\n  // Get the correct page container element\n  const getPageContainer = () => {\n    if (!pageContainerRef.current) return null;\n\n    // Try to find the page container - react-pdf creates a specific structure\n    const pageDiv = pageContainerRef.current.querySelector('.react-pdf__Page');\n    return pageDiv;\n  };\n\n  // Enhanced text selection handler with better coordinate calculation\n  const handleTextSelection = useCallback(async () => {\n    if (!isSelecting || isCreatingHighlight) return;\n    const selection = window.getSelection();\n    if (!selection.rangeCount || !selection.toString().trim()) return;\n    setIsCreatingHighlight(true);\n    try {\n      const range = selection.getRangeAt(0);\n      const selectedText = selection.toString().trim();\n\n      // Get the page container element\n      const pageContainer = getPageContainer();\n      if (!pageContainer) {\n        throw new Error('Page container not found');\n      }\n\n      // Get both canvas and text layer for accurate positioning\n      const canvas = pageContainer.querySelector('canvas');\n      const textLayer = pageContainer.querySelector('.react-pdf__Page__textContent');\n      if (!canvas) {\n        throw new Error('Canvas not found');\n      }\n\n      // Use the canvas dimensions for coordinate calculation\n      const pageRect = canvas.getBoundingClientRect();\n      const rangeRect = range.getBoundingClientRect();\n      console.log('Debug info:', {\n        pageRect: {\n          left: pageRect.left,\n          top: pageRect.top,\n          width: pageRect.width,\n          height: pageRect.height\n        },\n        rangeRect: {\n          left: rangeRect.left,\n          top: rangeRect.top,\n          width: rangeRect.width,\n          height: rangeRect.height\n        },\n        scale,\n        selectedText\n      });\n\n      // Calculate relative positions based on the actual rendered page\n      const relativeRect = {\n        left: Math.max(0, (rangeRect.left - pageRect.left) / pageRect.width),\n        top: Math.max(0, (rangeRect.top - pageRect.top) / pageRect.height),\n        right: Math.min(1, (rangeRect.right - pageRect.left) / pageRect.width),\n        bottom: Math.min(1, (rangeRect.bottom - pageRect.top) / pageRect.height)\n      };\n\n      // Additional validation with tolerance\n      const tolerance = 0.05; // 5% tolerance\n      if (relativeRect.left < -tolerance || relativeRect.top < -tolerance || relativeRect.right > 1 + tolerance || relativeRect.bottom > 1 + tolerance) {\n        console.log('Coordinates with tolerance check:', relativeRect);\n        throw new Error(`Selection coordinates out of bounds: left: ${relativeRect.left.toFixed(3)}, top: ${relativeRect.top.toFixed(3)}, right: ${relativeRect.right.toFixed(3)}, bottom: ${relativeRect.bottom.toFixed(3)}`);\n      }\n\n      // Ensure coordinates are within valid bounds\n      const boundedRect = {\n        left: Math.max(0, Math.min(1, relativeRect.left)),\n        top: Math.max(0, Math.min(1, relativeRect.top)),\n        right: Math.max(0, Math.min(1, relativeRect.right)),\n        bottom: Math.max(0, Math.min(1, relativeRect.bottom))\n      };\n      const highlightData = {\n        pdfUuid: uuid,\n        pageNumber,\n        highlightedText: selectedText,\n        position: {\n          x: boundedRect.left,\n          y: boundedRect.top,\n          width: boundedRect.right - boundedRect.left,\n          height: boundedRect.bottom - boundedRect.top\n        },\n        boundingBox: {\n          left: boundedRect.left,\n          top: boundedRect.top,\n          right: boundedRect.right,\n          bottom: boundedRect.bottom\n        }\n      };\n      console.log('Creating highlight with data:', highlightData);\n      await createHighlightMutation.mutateAsync(highlightData);\n    } catch (error) {\n      console.error('Error creating highlight:', error);\n      toast.error('Failed to create highlight: ' + error.message);\n      setIsCreatingHighlight(false);\n    } finally {\n      // Clear selection\n      selection.removeAllRanges();\n    }\n  }, [isSelecting, pageNumber, uuid, createHighlightMutation, isCreatingHighlight]);\n\n  // Handle mouse up event for text selection\n  const handleMouseUp = useCallback(event => {\n    if (!isSelecting) return;\n\n    // Check if the selection is within the page area\n    const pageContainer = getPageContainer();\n    if (!pageContainer) return;\n    const canvas = pageContainer.querySelector('canvas');\n    if (!canvas) return;\n    const canvasRect = canvas.getBoundingClientRect();\n    const {\n      clientX,\n      clientY\n    } = event;\n\n    // Check if mouse is within canvas bounds\n    if (clientX >= canvasRect.left && clientX <= canvasRect.right && clientY >= canvasRect.top && clientY <= canvasRect.bottom) {\n      // Small delay to ensure selection is complete\n      setTimeout(() => {\n        const selection = window.getSelection();\n        if (selection.toString().trim()) {\n          handleTextSelection();\n        }\n      }, 100);\n    }\n  }, [isSelecting, handleTextSelection]);\n\n  // Add event listeners for text selection\n  useEffect(() => {\n    const pageContainer = getPageContainer();\n    if (!pageContainer) return;\n    if (isSelecting) {\n      document.addEventListener('mouseup', handleMouseUp);\n      // Enable text selection on the entire page\n      pageContainer.style.userSelect = 'text';\n      pageContainer.style.cursor = 'text';\n    } else {\n      document.removeEventListener('mouseup', handleMouseUp);\n      pageContainer.style.userSelect = 'none';\n      pageContainer.style.cursor = 'default';\n    }\n    return () => {\n      document.removeEventListener('mouseup', handleMouseUp);\n    };\n  }, [isSelecting, handleMouseUp, pageNumber]); // Re-run when page changes\n\n  const renderHighlights = () => {\n    const pageHighlights = highlights.filter(h => h.pageNumber === pageNumber);\n    return pageHighlights.map(highlight => /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"absolute cursor-pointer transition-opacity hover:opacity-70\",\n      style: {\n        left: `${highlight.boundingBox.left * 100}%`,\n        top: `${highlight.boundingBox.top * 100}%`,\n        width: `${(highlight.boundingBox.right - highlight.boundingBox.left) * 100}%`,\n        height: `${(highlight.boundingBox.bottom - highlight.boundingBox.top) * 100}%`,\n        backgroundColor: highlight.color || '#ffff00',\n        opacity: 0.4,\n        mixBlendMode: 'multiply',\n        border: '1px solid rgba(255, 255, 0, 0.6)',\n        borderRadius: '2px',\n        pointerEvents: 'auto',\n        zIndex: 10\n      },\n      onClick: e => {\n        e.stopPropagation();\n        e.preventDefault();\n        if (window.confirm(`Delete highlight: \"${highlight.highlightedText}\"?`)) {\n          deleteHighlightMutation.mutate(highlight.uuid);\n        }\n      },\n      title: `\"${highlight.highlightedText}\" - Click to delete`\n    }, highlight.uuid, false, {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 7\n    }, this));\n  };\n  if (pdfLoading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex items-center justify-center min-h-screen\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 286,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"ml-3 text-lg\",\n        children: \"Loading PDF...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 287,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 285,\n      columnNumber: 7\n    }, this);\n  }\n  if (pdfError) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex items-center justify-center min-h-screen\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-red-500 text-xl mb-4\",\n          children: \"Failed to load PDF\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-gray-600 mb-4\",\n          children: pdfError.message\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 297,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/dashboard\",\n          className: \"text-blue-600 hover:underline\",\n          children: \"Back to Dashboard\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 298,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 295,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 294,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex flex-col h-screen\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-white border-b px-4 py-3 flex items-center justify-between\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center space-x-4\",\n        children: /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/dashboard\",\n          className: \"flex items-center text-gray-600 hover:text-gray-900\",\n          children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n            className: \"h-5 w-5 mr-1\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            viewBox: \"0 0 24 24\",\n            children: /*#__PURE__*/_jsxDEV(\"path\", {\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\",\n              strokeWidth: 2,\n              d: \"M15 19l-7-7 7-7\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 316,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 315,\n            columnNumber: 13\n          }, this), \"Back to Library\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 310,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center space-x-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setIsSelecting(!isSelecting),\n          disabled: isCreatingHighlight,\n          className: `flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors disabled:opacity-50 ${isSelecting ? 'bg-yellow-100 text-yellow-800 border border-yellow-300' : 'bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200'}`,\n          children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n            className: \"h-4 w-4 mr-2\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            viewBox: \"0 0 24 24\",\n            children: /*#__PURE__*/_jsxDEV(\"path\", {\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\",\n              strokeWidth: 2,\n              d: \"M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2h4a1 1 0 110 2h-1v10a2 2 0 01-2 2H6a2 2 0 01-2-2V6H3a1 1 0 110-2h4zM6 6v10h12V6H6zm3 3h6v2H9V9z\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 335,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 334,\n            columnNumber: 13\n          }, this), isCreatingHighlight ? 'Creating...' : isSelecting ? 'Highlighting On' : 'Enable Highlighting']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setScale(Math.max(0.5, scale - 0.1)),\n            className: \"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded\",\n            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n              className: \"h-4 w-4\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              viewBox: \"0 0 24 24\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 2,\n                d: \"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 347,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 346,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 342,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-sm text-gray-700 min-w-[60px] text-center\",\n            children: [Math.round(scale * 100), \"%\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 350,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setScale(Math.min(3.0, scale + 0.1)),\n            className: \"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded\",\n            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n              className: \"h-4 w-4\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              viewBox: \"0 0 24 24\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 2,\n                d: \"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM15 10h-3m0 0H9m3 0v3m0-3V7\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 358,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 357,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 353,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 341,\n          columnNumber: 11\n        }, this), numPages && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setPageNumber(Math.max(1, pageNumber - 1)),\n            disabled: pageNumber <= 1,\n            className: \"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded disabled:opacity-50 disabled:cursor-not-allowed\",\n            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n              className: \"h-4 w-4\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              viewBox: \"0 0 24 24\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 2,\n                d: \"M15 19l-7-7 7-7\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 372,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 371,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 366,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-sm text-gray-700 min-w-[80px] text-center\",\n            children: [pageNumber, \" of \", numPages]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 375,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setPageNumber(Math.min(numPages, pageNumber + 1)),\n            disabled: pageNumber >= numPages,\n            className: \"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded disabled:opacity-50 disabled:cursor-not-allowed\",\n            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n              className: \"h-4 w-4\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              viewBox: \"0 0 24 24\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 2,\n                d: \"M9 5l7 7-7 7\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 384,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 383,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 378,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 365,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 323,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 309,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 overflow-auto bg-gray-100 p-4\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex justify-center\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `relative ${isSelecting ? 'highlighting-mode' : ''}`,\n          ref: pageContainerRef,\n          children: pdfBlob ? /*#__PURE__*/_jsxDEV(Document, {\n            file: pdfBlob,\n            onLoadSuccess: onDocumentLoadSuccess,\n            onLoadError: error => {\n              console.error('PDF load error:', error);\n              toast.error('Failed to load PDF');\n            },\n            loading: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center justify-center p-8\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"loading-spinner w-8 h-8\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 409,\n                columnNumber: 15\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"ml-3\",\n                children: \"Loading document...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 410,\n                columnNumber: 15\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 408,\n              columnNumber: 13\n            }, this),\n            error: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center justify-center p-8 text-red-600\",\n              children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                className: \"w-6 h-6 mr-2\",\n                fill: \"none\",\n                stroke: \"currentColor\",\n                viewBox: \"0 0 24 24\",\n                children: /*#__PURE__*/_jsxDEV(\"path\", {\n                  strokeLinecap: \"round\",\n                  strokeLinejoin: \"round\",\n                  strokeWidth: 2,\n                  d: \"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 416,\n                  columnNumber: 17\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 415,\n                columnNumber: 15\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Failed to load PDF document\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 418,\n                columnNumber: 15\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 414,\n              columnNumber: 13\n            }, this),\n            className: \"shadow-lg\",\n            options: {\n              cMapUrl: 'https://unpkg.com/pdfjs-dist@3.11.174/cmaps/',\n              cMapPacked: true,\n              standardFontDataUrl: 'https://unpkg.com/pdfjs-dist@3.11.174/standard_fonts/'\n            },\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"relative pdf-page-container\",\n              children: [/*#__PURE__*/_jsxDEV(Page, {\n                pageNumber: pageNumber,\n                scale: scale,\n                renderTextLayer: true,\n                renderAnnotationLayer: false,\n                onLoadSuccess: onPageLoadSuccess,\n                onLoadError: error => {\n                  console.error(`Page ${pageNumber} load error:`, error);\n                  toast.error(`Failed to load page ${pageNumber}`);\n                },\n                loading: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex items-center justify-center p-4\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"loading-spinner w-6 h-6\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 441,\n                    columnNumber: 19\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"ml-2\",\n                    children: \"Loading page...\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 442,\n                    columnNumber: 19\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 440,\n                  columnNumber: 17\n                }, this),\n                error: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex items-center justify-center p-4 text-red-600\",\n                  children: /*#__PURE__*/_jsxDEV(\"span\", {\n                    children: [\"Failed to load page \", pageNumber]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 447,\n                    columnNumber: 19\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 446,\n                  columnNumber: 17\n                }, this),\n                className: \"pdf-page\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 429,\n                columnNumber: 13\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"absolute inset-0 pointer-events-none highlight-overlay\",\n                children: renderHighlights()\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 454,\n                columnNumber: 13\n              }, this), isCreatingHighlight && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"absolute inset-0 bg-white bg-opacity-50 flex items-center justify-center pointer-events-none z-20\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"bg-white rounded-lg shadow-lg p-4 flex items-center\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"loading-spinner w-4 h-4\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 462,\n                    columnNumber: 19\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"ml-2 text-sm\",\n                    children: \"Creating highlight...\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 463,\n                    columnNumber: 19\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 461,\n                  columnNumber: 17\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 460,\n                columnNumber: 15\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 428,\n              columnNumber: 11\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 400,\n            columnNumber: 9\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center justify-center p-8\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-center\",\n              children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                className: \"w-16 h-16 mx-auto text-gray-400 mb-4\",\n                fill: \"none\",\n                stroke: \"currentColor\",\n                viewBox: \"0 0 24 24\",\n                children: /*#__PURE__*/_jsxDEV(\"path\", {\n                  strokeLinecap: \"round\",\n                  strokeLinejoin: \"round\",\n                  strokeWidth: 2,\n                  d: \"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 473,\n                  columnNumber: 15\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 472,\n                columnNumber: 13\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-gray-500\",\n                children: \"No PDF loaded\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 475,\n                columnNumber: 13\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 471,\n              columnNumber: 11\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 470,\n            columnNumber: 9\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 395,\n          columnNumber: 5\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 394,\n        columnNumber: 3\n      }, this), numPages && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"fixed bottom-4 right-4 md:hidden\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-white rounded-lg shadow-lg p-2 flex items-center space-x-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setPageNumber(Math.max(1, pageNumber - 1)),\n            disabled: pageNumber <= 1,\n            className: \"p-2 text-gray-600 hover:text-gray-900 disabled:opacity-50\",\n            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n              className: \"w-4 h-4\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              viewBox: \"0 0 24 24\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 2,\n                d: \"M15 19l-7-7 7-7\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 492,\n                columnNumber: 13\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 491,\n              columnNumber: 11\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 486,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-sm text-gray-700 px-2\",\n            children: [pageNumber, \"/\", numPages]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 495,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setPageNumber(Math.min(numPages, pageNumber + 1)),\n            disabled: pageNumber >= numPages,\n            className: \"p-2 text-gray-600 hover:text-gray-900 disabled:opacity-50\",\n            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n              className: \"w-4 h-4\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              viewBox: \"0 0 24 24\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 2,\n                d: \"M9 5l7 7-7 7\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 504,\n                columnNumber: 13\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 503,\n              columnNumber: 11\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 498,\n            columnNumber: 9\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 485,\n          columnNumber: 7\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 484,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 393,\n      columnNumber: 1\n    }, this), isSelecting && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-yellow-50 border-t border-yellow-200 px-4 py-2\",\n      children: /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-sm text-yellow-800\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Highlighting Mode:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 515,\n          columnNumber: 13\n        }, this), \" Select text with your mouse to create highlights. Click on existing highlights to delete them.\", isCreatingHighlight && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"ml-2 text-yellow-600\",\n          children: \"(Creating highlight...)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 517,\n          columnNumber: 37\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 514,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 513,\n      columnNumber: 9\n    }, this), process.env.NODE_ENV === 'development' && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-gray-100 border-t px-4 py-2 text-xs text-gray-600\",\n      children: [\"Highlights: \", highlights.length, \" | Page: \", pageNumber, \" | Scale: \", scale.toFixed(1), \" | Page Size: \", pageSize.width.toFixed(0), \"x\", pageSize.height.toFixed(0)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 524,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 307,\n    columnNumber: 5\n  }, this);\n};\n_s(PDFViewer, \"/t5ifU1Iv2apheg903wSPscAN6o=\", false, function () {\n  return [useParams, useQueryClient, useQuery, useQuery, useMutation, useMutation];\n});\n_c = PDFViewer;\nexport default PDFViewer;\nvar _c;\n$RefreshReg$(_c, \"PDFViewer\");","map":{"version":3,"names":["React","useState","useRef","useCallback","useEffect","useParams","Link","useQuery","useMutation","useQueryClient","Document","Page","pdfjs","toast","pdfAPI","highlightAPI","v4","uuidv4","jsxDEV","_jsxDEV","GlobalWorkerOptions","workerSrc","version","PDFViewer","_s","uuid","numPages","setNumPages","pageNumber","setPageNumber","scale","setScale","isSelecting","setIsSelecting","highlights","setHighlights","isCreatingHighlight","setIsCreatingHighlight","pageSize","setPageSize","width","height","pageContainerRef","queryClient","data","pdfBlob","isLoading","pdfLoading","error","pdfError","get","select","response","Blob","type","enabled","retry","highlightsData","getByPDF","onSuccess","onError","console","createHighlightMutation","create","invalidateQueries","success","_error$response","_error$response$data","deleteHighlightMutation","delete","_error$response2","_error$response2$data","onDocumentLoadSuccess","log","onPageLoadSuccess","page","originalWidth","originalHeight","getPageContainer","current","pageDiv","querySelector","handleTextSelection","selection","window","getSelection","rangeCount","toString","trim","range","getRangeAt","selectedText","pageContainer","Error","canvas","textLayer","pageRect","getBoundingClientRect","rangeRect","left","top","relativeRect","Math","max","right","min","bottom","tolerance","toFixed","boundedRect","highlightData","pdfUuid","highlightedText","position","x","y","boundingBox","mutateAsync","message","removeAllRanges","handleMouseUp","event","canvasRect","clientX","clientY","setTimeout","document","addEventListener","style","userSelect","cursor","removeEventListener","renderHighlights","pageHighlights","filter","h","map","highlight","className","backgroundColor","color","opacity","mixBlendMode","border","borderRadius","pointerEvents","zIndex","onClick","e","stopPropagation","preventDefault","confirm","mutate","title","fileName","_jsxFileName","lineNumber","columnNumber","children","to","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","disabled","round","ref","file","onLoadSuccess","onLoadError","loading","options","cMapUrl","cMapPacked","standardFontDataUrl","renderTextLayer","renderAnnotationLayer","process","env","NODE_ENV","length","_c","$RefreshReg$"],"sources":["D:/pdf demo/frontend/src/pages/PDFViewer.js"],"sourcesContent":["import React, { useState, useRef, useCallback, useEffect } from 'react';\r\nimport { useParams, Link } from 'react-router-dom';\r\nimport { useQuery, useMutation, useQueryClient } from 'react-query';\r\nimport { Document, Page, pdfjs } from 'react-pdf';\r\nimport toast from 'react-hot-toast';\r\nimport { pdfAPI, highlightAPI } from '../services/api';\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\n// Set up PDF.js worker\r\npdfjs.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.min.js`;\r\n\r\nconst PDFViewer = () => {\r\n  const { uuid } = useParams();\r\n  const [numPages, setNumPages] = useState(null);\r\n  const [pageNumber, setPageNumber] = useState(1);\r\n  const [scale, setScale] = useState(1.0);\r\n  const [isSelecting, setIsSelecting] = useState(false);\r\n  const [highlights, setHighlights] = useState([]);\r\n  const [isCreatingHighlight, setIsCreatingHighlight] = useState(false);\r\n  const [pageSize, setPageSize] = useState({ width: 0, height: 0 });\r\n  const pageContainerRef = useRef(null);\r\n  const queryClient = useQueryClient();\r\n\r\n  // Fetch PDF file as blob\r\n  const { data: pdfBlob, isLoading: pdfLoading, error: pdfError } = useQuery(\r\n    ['pdf', uuid],\r\n    () => pdfAPI.get(uuid),\r\n    {\r\n      select: (response) => new Blob([response.data], { type: 'application/pdf' }),\r\n      enabled: !!uuid,\r\n      retry: 2,\r\n    }\r\n  );\r\n\r\n  // Fetch highlights for this PDF\r\n  const { data: highlightsData } = useQuery(\r\n    ['highlights', uuid],\r\n    () => highlightAPI.getByPDF(uuid),\r\n    {\r\n      enabled: !!uuid,\r\n      onSuccess: (response) => {\r\n        setHighlights(response.data.highlights || []);\r\n      },\r\n      onError: (error) => {\r\n        console.error('Failed to fetch highlights:', error);\r\n        toast.error('Failed to load highlights');\r\n      },\r\n    }\r\n  );\r\n\r\n  // Create highlight mutation\r\n  const createHighlightMutation = useMutation(highlightAPI.create, {\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries(['highlights', uuid]);\r\n      toast.success('Highlight created!');\r\n      setIsCreatingHighlight(false);\r\n    },\r\n    onError: (error) => {\r\n      console.error('Failed to create highlight:', error);\r\n      toast.error(error.response?.data?.error || 'Failed to create highlight');\r\n      setIsCreatingHighlight(false);\r\n    },\r\n  });\r\n\r\n  // Delete highlight mutation\r\n  const deleteHighlightMutation = useMutation(highlightAPI.delete, {\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries(['highlights', uuid]);\r\n      toast.success('Highlight deleted!');\r\n    },\r\n    onError: (error) => {\r\n      toast.error(error.response?.data?.error || 'Failed to delete highlight');\r\n    },\r\n  });\r\n\r\n  const onDocumentLoadSuccess = ({ numPages }) => {\r\n    setNumPages(numPages);\r\n    console.log('PDF loaded with', numPages, 'pages');\r\n  };\r\n\r\n  const onPageLoadSuccess = (page) => {\r\n    const { width, height } = page.originalWidth \r\n      ? { width: page.originalWidth, height: page.originalHeight }\r\n      : { width: page.width, height: page.height };\r\n    \r\n    setPageSize({ width: width * scale, height: height * scale });\r\n    console.log('Page loaded:', { width: width * scale, height: height * scale, scale });\r\n  };\r\n\r\n  // Get the correct page container element\r\n  const getPageContainer = () => {\r\n    if (!pageContainerRef.current) return null;\r\n    \r\n    // Try to find the page container - react-pdf creates a specific structure\r\n    const pageDiv = pageContainerRef.current.querySelector('.react-pdf__Page');\r\n    return pageDiv;\r\n  };\r\n\r\n  // Enhanced text selection handler with better coordinate calculation\r\n  const handleTextSelection = useCallback(async () => {\r\n    if (!isSelecting || isCreatingHighlight) return;\r\n\r\n    const selection = window.getSelection();\r\n    if (!selection.rangeCount || !selection.toString().trim()) return;\r\n\r\n    setIsCreatingHighlight(true);\r\n\r\n    try {\r\n      const range = selection.getRangeAt(0);\r\n      const selectedText = selection.toString().trim();\r\n      \r\n      // Get the page container element\r\n      const pageContainer = getPageContainer();\r\n      if (!pageContainer) {\r\n        throw new Error('Page container not found');\r\n      }\r\n\r\n      // Get both canvas and text layer for accurate positioning\r\n      const canvas = pageContainer.querySelector('canvas');\r\n      const textLayer = pageContainer.querySelector('.react-pdf__Page__textContent');\r\n      \r\n      if (!canvas) {\r\n        throw new Error('Canvas not found');\r\n      }\r\n\r\n      // Use the canvas dimensions for coordinate calculation\r\n      const pageRect = canvas.getBoundingClientRect();\r\n      const rangeRect = range.getBoundingClientRect();\r\n\r\n      console.log('Debug info:', {\r\n        pageRect: {\r\n          left: pageRect.left,\r\n          top: pageRect.top,\r\n          width: pageRect.width,\r\n          height: pageRect.height\r\n        },\r\n        rangeRect: {\r\n          left: rangeRect.left,\r\n          top: rangeRect.top,\r\n          width: rangeRect.width,\r\n          height: rangeRect.height\r\n        },\r\n        scale,\r\n        selectedText\r\n      });\r\n\r\n      // Calculate relative positions based on the actual rendered page\r\n      const relativeRect = {\r\n        left: Math.max(0, (rangeRect.left - pageRect.left) / pageRect.width),\r\n        top: Math.max(0, (rangeRect.top - pageRect.top) / pageRect.height),\r\n        right: Math.min(1, (rangeRect.right - pageRect.left) / pageRect.width),\r\n        bottom: Math.min(1, (rangeRect.bottom - pageRect.top) / pageRect.height),\r\n      };\r\n\r\n      // Additional validation with tolerance\r\n      const tolerance = 0.05; // 5% tolerance\r\n      if (relativeRect.left < -tolerance || relativeRect.top < -tolerance || \r\n          relativeRect.right > (1 + tolerance) || relativeRect.bottom > (1 + tolerance)) {\r\n        console.log('Coordinates with tolerance check:', relativeRect);\r\n        throw new Error(`Selection coordinates out of bounds: left: ${relativeRect.left.toFixed(3)}, top: ${relativeRect.top.toFixed(3)}, right: ${relativeRect.right.toFixed(3)}, bottom: ${relativeRect.bottom.toFixed(3)}`);\r\n      }\r\n\r\n      // Ensure coordinates are within valid bounds\r\n      const boundedRect = {\r\n        left: Math.max(0, Math.min(1, relativeRect.left)),\r\n        top: Math.max(0, Math.min(1, relativeRect.top)),\r\n        right: Math.max(0, Math.min(1, relativeRect.right)),\r\n        bottom: Math.max(0, Math.min(1, relativeRect.bottom)),\r\n      };\r\n\r\n      const highlightData = {\r\n        pdfUuid: uuid,\r\n        pageNumber,\r\n        highlightedText: selectedText,\r\n        position: {\r\n          x: boundedRect.left,\r\n          y: boundedRect.top,\r\n          width: boundedRect.right - boundedRect.left,\r\n          height: boundedRect.bottom - boundedRect.top,\r\n        },\r\n        boundingBox: {\r\n          left: boundedRect.left,\r\n          top: boundedRect.top,\r\n          right: boundedRect.right,\r\n          bottom: boundedRect.bottom,\r\n        },\r\n      };\r\n\r\n      console.log('Creating highlight with data:', highlightData);\r\n      await createHighlightMutation.mutateAsync(highlightData);\r\n      \r\n    } catch (error) {\r\n      console.error('Error creating highlight:', error);\r\n      toast.error('Failed to create highlight: ' + error.message);\r\n      setIsCreatingHighlight(false);\r\n    } finally {\r\n      // Clear selection\r\n      selection.removeAllRanges();\r\n    }\r\n  }, [isSelecting, pageNumber, uuid, createHighlightMutation, isCreatingHighlight]);\r\n\r\n  // Handle mouse up event for text selection\r\n  const handleMouseUp = useCallback((event) => {\r\n    if (!isSelecting) return;\r\n    \r\n    // Check if the selection is within the page area\r\n    const pageContainer = getPageContainer();\r\n    if (!pageContainer) return;\r\n\r\n    const canvas = pageContainer.querySelector('canvas');\r\n    if (!canvas) return;\r\n\r\n    const canvasRect = canvas.getBoundingClientRect();\r\n    const { clientX, clientY } = event;\r\n\r\n    // Check if mouse is within canvas bounds\r\n    if (clientX >= canvasRect.left && clientX <= canvasRect.right &&\r\n        clientY >= canvasRect.top && clientY <= canvasRect.bottom) {\r\n      \r\n      // Small delay to ensure selection is complete\r\n      setTimeout(() => {\r\n        const selection = window.getSelection();\r\n        if (selection.toString().trim()) {\r\n          handleTextSelection();\r\n        }\r\n      }, 100);\r\n    }\r\n  }, [isSelecting, handleTextSelection]);\r\n\r\n  // Add event listeners for text selection\r\n  useEffect(() => {\r\n    const pageContainer = getPageContainer();\r\n    if (!pageContainer) return;\r\n\r\n    if (isSelecting) {\r\n      document.addEventListener('mouseup', handleMouseUp);\r\n      // Enable text selection on the entire page\r\n      pageContainer.style.userSelect = 'text';\r\n      pageContainer.style.cursor = 'text';\r\n    } else {\r\n      document.removeEventListener('mouseup', handleMouseUp);\r\n      pageContainer.style.userSelect = 'none';\r\n      pageContainer.style.cursor = 'default';\r\n    }\r\n\r\n    return () => {\r\n      document.removeEventListener('mouseup', handleMouseUp);\r\n    };\r\n  }, [isSelecting, handleMouseUp, pageNumber]); // Re-run when page changes\r\n\r\n  const renderHighlights = () => {\r\n    const pageHighlights = highlights.filter(h => h.pageNumber === pageNumber);\r\n    \r\n    return pageHighlights.map((highlight) => (\r\n      <div\r\n        key={highlight.uuid}\r\n        className=\"absolute cursor-pointer transition-opacity hover:opacity-70\"\r\n        style={{\r\n          left: `${highlight.boundingBox.left * 100}%`,\r\n          top: `${highlight.boundingBox.top * 100}%`,\r\n          width: `${(highlight.boundingBox.right - highlight.boundingBox.left) * 100}%`,\r\n          height: `${(highlight.boundingBox.bottom - highlight.boundingBox.top) * 100}%`,\r\n          backgroundColor: highlight.color || '#ffff00',\r\n          opacity: 0.4,\r\n          mixBlendMode: 'multiply',\r\n          border: '1px solid rgba(255, 255, 0, 0.6)',\r\n          borderRadius: '2px',\r\n          pointerEvents: 'auto',\r\n          zIndex: 10,\r\n        }}\r\n        onClick={(e) => {\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n          if (window.confirm(`Delete highlight: \"${highlight.highlightedText}\"?`)) {\r\n            deleteHighlightMutation.mutate(highlight.uuid);\r\n          }\r\n        }}\r\n        title={`\"${highlight.highlightedText}\" - Click to delete`}\r\n      />\r\n    ));\r\n  };\r\n\r\n  if (pdfLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n        <span className=\"ml-3 text-lg\">Loading PDF...</span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (pdfError) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"text-center\">\r\n          <div className=\"text-red-500 text-xl mb-4\">Failed to load PDF</div>\r\n          <p className=\"text-gray-600 mb-4\">{pdfError.message}</p>\r\n          <Link to=\"/dashboard\" className=\"text-blue-600 hover:underline\">\r\n            Back to Dashboard\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-screen\">\r\n      {/* Header */}\r\n      <div className=\"bg-white border-b px-4 py-3 flex items-center justify-between\">\r\n        <div className=\"flex items-center space-x-4\">\r\n          <Link\r\n            to=\"/dashboard\"\r\n            className=\"flex items-center text-gray-600 hover:text-gray-900\"\r\n          >\r\n            <svg className=\"h-5 w-5 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\r\n            </svg>\r\n            Back to Library\r\n          </Link>\r\n        </div>\r\n\r\n        {/* Controls */}\r\n        <div className=\"flex items-center space-x-4\">\r\n          {/* Highlight Toggle */}\r\n          <button\r\n            onClick={() => setIsSelecting(!isSelecting)}\r\n            disabled={isCreatingHighlight}\r\n            className={`flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors disabled:opacity-50 ${\r\n              isSelecting\r\n                ? 'bg-yellow-100 text-yellow-800 border border-yellow-300'\r\n                : 'bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200'\r\n            }`}\r\n          >\r\n            <svg className=\"h-4 w-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2h4a1 1 0 110 2h-1v10a2 2 0 01-2 2H6a2 2 0 01-2-2V6H3a1 1 0 110-2h4zM6 6v10h12V6H6zm3 3h6v2H9V9z\" />\r\n            </svg>\r\n            {isCreatingHighlight ? 'Creating...' : (isSelecting ? 'Highlighting On' : 'Enable Highlighting')}\r\n          </button>\r\n\r\n          {/* Zoom Controls */}\r\n          <div className=\"flex items-center space-x-2\">\r\n            <button\r\n              onClick={() => setScale(Math.max(0.5, scale - 0.1))}\r\n              className=\"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded\"\r\n            >\r\n              <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7\" />\r\n              </svg>\r\n            </button>\r\n            <span className=\"text-sm text-gray-700 min-w-[60px] text-center\">\r\n              {Math.round(scale * 100)}%\r\n            </span>\r\n            <button\r\n              onClick={() => setScale(Math.min(3.0, scale + 0.1))}\r\n              className=\"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded\"\r\n            >\r\n              <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM15 10h-3m0 0H9m3 0v3m0-3V7\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n\r\n          {/* Page Navigation */}\r\n          {numPages && (\r\n            <div className=\"flex items-center space-x-2\">\r\n              <button\r\n                onClick={() => setPageNumber(Math.max(1, pageNumber - 1))}\r\n                disabled={pageNumber <= 1}\r\n                className=\"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded disabled:opacity-50 disabled:cursor-not-allowed\"\r\n              >\r\n                <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\r\n                </svg>\r\n              </button>\r\n              <span className=\"text-sm text-gray-700 min-w-[80px] text-center\">\r\n                {pageNumber} of {numPages}\r\n              </span>\r\n              <button\r\n                onClick={() => setPageNumber(Math.min(numPages, pageNumber + 1))}\r\n                disabled={pageNumber >= numPages}\r\n                className=\"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded disabled:opacity-50 disabled:cursor-not-allowed\"\r\n              >\r\n                <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* PDF Viewer */}\r\n<div className=\"flex-1 overflow-auto bg-gray-100 p-4\">\r\n  <div className=\"flex justify-center\">\r\n    <div \r\n      className={`relative ${isSelecting ? 'highlighting-mode' : ''}`} \r\n      ref={pageContainerRef}\r\n    >\r\n      {pdfBlob ? (\r\n        <Document\r\n          file={pdfBlob}\r\n          onLoadSuccess={onDocumentLoadSuccess}\r\n          onLoadError={(error) => {\r\n            console.error('PDF load error:', error);\r\n            toast.error('Failed to load PDF');\r\n          }}\r\n          loading={\r\n            <div className=\"flex items-center justify-center p-8\">\r\n              <div className=\"loading-spinner w-8 h-8\"></div>\r\n              <span className=\"ml-3\">Loading document...</span>\r\n            </div>\r\n          }\r\n          error={\r\n            <div className=\"flex items-center justify-center p-8 text-red-600\">\r\n              <svg className=\"w-6 h-6 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n              </svg>\r\n              <span>Failed to load PDF document</span>\r\n            </div>\r\n          }\r\n          className=\"shadow-lg\"\r\n          options={{\r\n            cMapUrl: 'https://unpkg.com/pdfjs-dist@3.11.174/cmaps/',\r\n            cMapPacked: true,\r\n            standardFontDataUrl: 'https://unpkg.com/pdfjs-dist@3.11.174/standard_fonts/',\r\n          }}\r\n        >\r\n          <div className=\"relative pdf-page-container\">\r\n            <Page\r\n              pageNumber={pageNumber}\r\n              scale={scale}\r\n              renderTextLayer={true}\r\n              renderAnnotationLayer={false}\r\n              onLoadSuccess={onPageLoadSuccess}\r\n              onLoadError={(error) => {\r\n                console.error(`Page ${pageNumber} load error:`, error);\r\n                toast.error(`Failed to load page ${pageNumber}`);\r\n              }}\r\n              loading={\r\n                <div className=\"flex items-center justify-center p-4\">\r\n                  <div className=\"loading-spinner w-6 h-6\"></div>\r\n                  <span className=\"ml-2\">Loading page...</span>\r\n                </div>\r\n              }\r\n              error={\r\n                <div className=\"flex items-center justify-center p-4 text-red-600\">\r\n                  <span>Failed to load page {pageNumber}</span>\r\n                </div>\r\n              }\r\n              className=\"pdf-page\"\r\n            />\r\n            \r\n            {/* Highlight overlay */}\r\n            <div className=\"absolute inset-0 pointer-events-none highlight-overlay\">\r\n              {renderHighlights()}\r\n            </div>\r\n            \r\n            {/* Loading overlay for highlight creation */}\r\n            {isCreatingHighlight && (\r\n              <div className=\"absolute inset-0 bg-white bg-opacity-50 flex items-center justify-center pointer-events-none z-20\">\r\n                <div className=\"bg-white rounded-lg shadow-lg p-4 flex items-center\">\r\n                  <div className=\"loading-spinner w-4 h-4\"></div>\r\n                  <span className=\"ml-2 text-sm\">Creating highlight...</span>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </Document>\r\n      ) : (\r\n        <div className=\"flex items-center justify-center p-8\">\r\n          <div className=\"text-center\">\r\n            <svg className=\"w-16 h-16 mx-auto text-gray-400 mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n            </svg>\r\n            <p className=\"text-gray-500\">No PDF loaded</p>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  </div>\r\n  \r\n  {/* Floating controls for mobile */}\r\n  {numPages && (\r\n    <div className=\"fixed bottom-4 right-4 md:hidden\">\r\n      <div className=\"bg-white rounded-lg shadow-lg p-2 flex items-center space-x-2\">\r\n        <button\r\n          onClick={() => setPageNumber(Math.max(1, pageNumber - 1))}\r\n          disabled={pageNumber <= 1}\r\n          className=\"p-2 text-gray-600 hover:text-gray-900 disabled:opacity-50\"\r\n        >\r\n          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\r\n          </svg>\r\n        </button>\r\n        <span className=\"text-sm text-gray-700 px-2\">\r\n          {pageNumber}/{numPages}\r\n        </span>\r\n        <button\r\n          onClick={() => setPageNumber(Math.min(numPages, pageNumber + 1))}\r\n          disabled={pageNumber >= numPages}\r\n          className=\"p-2 text-gray-600 hover:text-gray-900 disabled:opacity-50\"\r\n        >\r\n          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\r\n          </svg>\r\n        </button>\r\n      </div>\r\n    </div>\r\n  )}\r\n</div>\r\n      {/* Instructions */}\r\n      {isSelecting && (\r\n        <div className=\"bg-yellow-50 border-t border-yellow-200 px-4 py-2\">\r\n          <p className=\"text-sm text-yellow-800\">\r\n            <strong>Highlighting Mode:</strong> Select text with your mouse to create highlights. \r\n            Click on existing highlights to delete them.\r\n            {isCreatingHighlight && <span className=\"ml-2 text-yellow-600\">(Creating highlight...)</span>}\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Debug info */}\r\n      {process.env.NODE_ENV === 'development' && (\r\n        <div className=\"bg-gray-100 border-t px-4 py-2 text-xs text-gray-600\">\r\n          Highlights: {highlights.length} | Page: {pageNumber} | Scale: {scale.toFixed(1)} | Page Size: {pageSize.width.toFixed(0)}x{pageSize.height.toFixed(0)}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PDFViewer;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}