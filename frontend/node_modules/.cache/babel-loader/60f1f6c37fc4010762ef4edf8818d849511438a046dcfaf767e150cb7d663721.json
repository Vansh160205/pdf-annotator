{"ast":null,"code":"var _jsxFileName = \"D:\\\\pdf demo\\\\frontend\\\\src\\\\components\\\\DrawingTools.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect, useCallback } from 'react';\nimport { useMutation, useQueryClient } from 'react-query';\nimport { drawingAPI } from '../services/api';\nimport { Pen, ArrowRight, Square, Circle, Minus, Palette, X } from 'lucide-react';\nimport { v4 as uuidv4 } from 'uuid';\nimport toast from 'react-hot-toast';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst DrawingTools = ({\n  pdfUuid,\n  pageNumber,\n  scale,\n  isEnabled,\n  onDrawingChange,\n  pageContainerRef\n}) => {\n  _s();\n  const [tool, setTool] = useState('freehand');\n  const [color, setColor] = useState('#ff0000');\n  const [strokeWidth, setStrokeWidth] = useState(2);\n  const [isDrawing, setIsDrawing] = useState(false);\n  const [currentPath, setCurrentPath] = useState([]);\n  const [showTools, setShowTools] = useState(true);\n  const svgRef = useRef(null);\n  const queryClient = useQueryClient();\n  const createDrawingMutation = useMutation(drawingAPI.create, {\n    onSuccess: () => {\n      queryClient.invalidateQueries(['drawings', pdfUuid]);\n      toast.success('Drawing saved!');\n    },\n    onError: error => {\n      toast.error('Failed to save drawing');\n      console.error('Failed to save drawing:', error);\n    }\n  });\n  const tools = [{\n    id: 'freehand',\n    icon: Pen,\n    name: 'Freehand'\n  }, {\n    id: 'arrow',\n    icon: ArrowRight,\n    name: 'Arrow'\n  }, {\n    id: 'rectangle',\n    icon: Square,\n    name: 'Rectangle'\n  }, {\n    id: 'circle',\n    icon: Circle,\n    name: 'Circle'\n  }, {\n    id: 'line',\n    icon: Minus,\n    name: 'Line'\n  }];\n  const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#000000'];\n  const getPageCanvas = useCallback(() => {\n    if (!(pageContainerRef !== null && pageContainerRef !== void 0 && pageContainerRef.current)) return null;\n    const pageContainer = pageContainerRef.current;\n    return pageContainer.querySelector('canvas');\n  }, [pageContainerRef]);\n  const getRelativePosition = useCallback(e => {\n    const canvas = getPageCanvas();\n    if (!canvas) return {\n      x: 0,\n      y: 0\n    };\n    const rect = canvas.getBoundingClientRect();\n    const x = (e.clientX - rect.left) / rect.width;\n    const y = (e.clientY - rect.top) / rect.height;\n\n    // Clamp to valid range\n    return {\n      x: Math.max(0, Math.min(1, x)),\n      y: Math.max(0, Math.min(1, y))\n    };\n  }, [getPageCanvas]);\n  const getAbsolutePosition = useCallback(relativePos => {\n    const canvas = getPageCanvas();\n    if (!canvas) return {\n      x: 0,\n      y: 0\n    };\n    const rect = canvas.getBoundingClientRect();\n    return {\n      x: relativePos.x * rect.width,\n      y: relativePos.y * rect.height\n    };\n  }, [getPageCanvas]);\n  const handleMouseDown = useCallback(e => {\n    if (!isEnabled) return;\n    e.preventDefault();\n    e.stopPropagation();\n    console.log('Mouse down - starting drawing');\n    setIsDrawing(true);\n    const pos = getRelativePosition(e);\n    setCurrentPath([pos]);\n  }, [isEnabled, getRelativePosition]);\n  const handleMouseMove = useCallback(e => {\n    if (!isDrawing || !isEnabled) return;\n    e.preventDefault();\n    e.stopPropagation();\n    const pos = getRelativePosition(e);\n    if (tool === 'freehand') {\n      setCurrentPath(prev => [...prev, pos]);\n    } else {\n      // For shapes, only keep start and current position\n      setCurrentPath(prev => [prev[0], pos]);\n    }\n  }, [isDrawing, isEnabled, tool, getRelativePosition]);\n  const handleMouseUp = useCallback(async e => {\n    if (!isDrawing || currentPath.length === 0) return;\n    e.preventDefault();\n    e.stopPropagation();\n    console.log('Mouse up - finishing drawing', {\n      tool,\n      pathLength: currentPath.length\n    });\n\n    // Validate path based on tool\n    let validPath = [...currentPath];\n    if (tool !== 'freehand' && validPath.length > 2) {\n      validPath = [validPath[0], validPath[validPath.length - 1]];\n    }\n    if (validPath.length < 2) {\n      console.log('Path too short, canceling');\n      setIsDrawing(false);\n      setCurrentPath([]);\n      return;\n    }\n    const drawingData = {\n      uuid: uuidv4(),\n      pdfUuid,\n      pageNumber,\n      type: tool,\n      data: {\n        path: validPath,\n        scale\n      },\n      style: {\n        color,\n        strokeWidth,\n        opacity: 1\n      }\n    };\n    try {\n      console.log('Saving drawing:', drawingData);\n      await createDrawingMutation.mutateAsync(drawingData);\n      onDrawingChange && onDrawingChange(drawingData);\n    } catch (error) {\n      console.error('Failed to save drawing:', error);\n    }\n    setIsDrawing(false);\n    setCurrentPath([]);\n  }, [isDrawing, currentPath, tool, pdfUuid, pageNumber, scale, color, strokeWidth, createDrawingMutation, onDrawingChange]);\n\n  // Add event listeners\n  useEffect(() => {\n    if (!isEnabled) return;\n    const canvas = getPageCanvas();\n    if (!canvas) return;\n    console.log('Adding event listeners to canvas');\n\n    // Prevent text selection while drawing\n    const preventSelection = e => e.preventDefault();\n    canvas.addEventListener('mousedown', handleMouseDown);\n    canvas.addEventListener('mousemove', handleMouseMove);\n    canvas.addEventListener('mouseup', handleMouseUp);\n    canvas.addEventListener('selectstart', preventSelection);\n\n    // Also listen on document for mouse up (in case user drags outside)\n    document.addEventListener('mouseup', handleMouseUp);\n    canvas.style.cursor = 'crosshair';\n    return () => {\n      console.log('Removing event listeners');\n      canvas.removeEventListener('mousedown', handleMouseDown);\n      canvas.removeEventListener('mousemove', handleMouseMove);\n      canvas.removeEventListener('mouseup', handleMouseUp);\n      canvas.removeEventListener('selectstart', preventSelection);\n      document.removeEventListener('mouseup', handleMouseUp);\n      canvas.style.cursor = 'default';\n    };\n  }, [isEnabled, handleMouseDown, handleMouseMove, handleMouseUp, getPageCanvas]);\n  const renderCurrentDrawing = () => {\n    if (currentPath.length === 0) return null;\n    const canvas = getPageCanvas();\n    if (!canvas) return null;\n    const rect = canvas.getBoundingClientRect();\n    switch (tool) {\n      case 'freehand':\n        if (currentPath.length < 2) return null;\n        const pathData = `M ${currentPath[0].x * rect.width} ${currentPath[0].y * rect.height} ` + currentPath.slice(1).map(p => `L ${p.x * rect.width} ${p.y * rect.height}`).join(' ');\n        return /*#__PURE__*/_jsxDEV(\"path\", {\n          d: pathData,\n          stroke: color,\n          strokeWidth: strokeWidth,\n          fill: \"none\",\n          strokeLinecap: \"round\",\n          strokeLinejoin: \"round\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 11\n        }, this);\n      case 'line':\n        if (currentPath.length < 2) return null;\n        return /*#__PURE__*/_jsxDEV(\"line\", {\n          x1: currentPath[0].x * rect.width,\n          y1: currentPath[0].y * rect.height,\n          x2: currentPath[1].x * rect.width,\n          y2: currentPath[1].y * rect.height,\n          stroke: color,\n          strokeWidth: strokeWidth\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 206,\n          columnNumber: 11\n        }, this);\n      case 'rectangle':\n        if (currentPath.length < 2) return null;\n        const rectData = {\n          x: Math.min(currentPath[0].x, currentPath[1].x) * rect.width,\n          y: Math.min(currentPath[0].y, currentPath[1].y) * rect.height,\n          width: Math.abs(currentPath[1].x - currentPath[0].x) * rect.width,\n          height: Math.abs(currentPath[1].y - currentPath[0].y) * rect.height\n        };\n        return /*#__PURE__*/_jsxDEV(\"rect\", {\n          x: rectData.x,\n          y: rectData.y,\n          width: rectData.width,\n          height: rectData.height,\n          stroke: color,\n          strokeWidth: strokeWidth,\n          fill: \"none\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 11\n        }, this);\n      case 'circle':\n        if (currentPath.length < 2) return null;\n        const radius = Math.sqrt(Math.pow((currentPath[1].x - currentPath[0].x) * rect.width, 2) + Math.pow((currentPath[1].y - currentPath[0].y) * rect.height, 2));\n        return /*#__PURE__*/_jsxDEV(\"circle\", {\n          cx: currentPath[0].x * rect.width,\n          cy: currentPath[0].y * rect.height,\n          r: radius,\n          stroke: color,\n          strokeWidth: strokeWidth,\n          fill: \"none\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 243,\n          columnNumber: 11\n        }, this);\n      case 'arrow':\n        if (currentPath.length < 2) return null;\n        const start = currentPath[0];\n        const end = currentPath[1];\n        const angle = Math.atan2((end.y - start.y) * rect.height, (end.x - start.x) * rect.width);\n        const arrowLength = 15;\n        const arrowAngle = Math.PI / 6;\n        return /*#__PURE__*/_jsxDEV(\"g\", {\n          children: [/*#__PURE__*/_jsxDEV(\"line\", {\n            x1: start.x * rect.width,\n            y1: start.y * rect.height,\n            x2: end.x * rect.width,\n            y2: end.y * rect.height,\n            stroke: color,\n            strokeWidth: strokeWidth\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 263,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n            d: `M ${end.x * rect.width} ${end.y * rect.height} \n                  L ${end.x * rect.width - arrowLength * Math.cos(angle - arrowAngle)} ${end.y * rect.height - arrowLength * Math.sin(angle - arrowAngle)}\n                  M ${end.x * rect.width} ${end.y * rect.height}\n                  L ${end.x * rect.width - arrowLength * Math.cos(angle + arrowAngle)} ${end.y * rect.height - arrowLength * Math.sin(angle + arrowAngle)}`,\n            stroke: color,\n            strokeWidth: strokeWidth,\n            fill: \"none\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 271,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 11\n        }, this);\n      default:\n        return null;\n    }\n  };\n  if (!isEnabled) return null;\n  const canvas = getPageCanvas();\n  const canvasRect = canvas === null || canvas === void 0 ? void 0 : canvas.getBoundingClientRect();\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: `fixed left-4 top-1/2 transform -translate-y-1/2 bg-white rounded-lg shadow-lg p-4 z-40 transition-transform ${showTools ? '' : '-translate-x-full'}`,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"space-y-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-between items-center\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"text-sm font-medium\",\n            children: \"Drawing Tools\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 300,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setShowTools(false),\n            className: \"p-1 hover:bg-gray-100 rounded\",\n            children: /*#__PURE__*/_jsxDEV(X, {\n              className: \"h-4 w-4\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 305,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 301,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 299,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"space-y-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n            className: \"text-xs font-medium text-gray-600\",\n            children: \"Tools\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 311,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"grid grid-cols-2 gap-2\",\n            children: tools.map(toolItem => {\n              const Icon = toolItem.icon;\n              return /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => setTool(toolItem.id),\n                className: `p-2 rounded border flex items-center justify-center ${tool === toolItem.id ? 'bg-blue-100 border-blue-500 text-blue-700' : 'border-gray-300 hover:bg-gray-50'}`,\n                title: toolItem.name,\n                children: /*#__PURE__*/_jsxDEV(Icon, {\n                  className: \"h-4 w-4\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 326,\n                  columnNumber: 21\n                }, this)\n              }, toolItem.id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 316,\n                columnNumber: 19\n              }, this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 312,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 310,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"space-y-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n            className: \"text-xs font-medium text-gray-600\",\n            children: \"Color\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 335,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex flex-wrap gap-1\",\n            children: colors.map(colorOption => /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => setColor(colorOption),\n              className: `w-6 h-6 rounded border-2 ${color === colorOption ? 'border-gray-800' : 'border-gray-300'}`,\n              style: {\n                backgroundColor: colorOption\n              }\n            }, colorOption, false, {\n              fileName: _jsxFileName,\n              lineNumber: 338,\n              columnNumber: 17\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 336,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"color\",\n            value: color,\n            onChange: e => setColor(e.target.value),\n            className: \"w-full h-8 rounded border\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 348,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 334,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"space-y-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n            className: \"text-xs font-medium text-gray-600\",\n            children: \"Stroke Width\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 358,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"range\",\n            min: \"1\",\n            max: \"10\",\n            value: strokeWidth,\n            onChange: e => setStrokeWidth(parseInt(e.target.value)),\n            className: \"w-full\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 359,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-xs text-gray-600\",\n            children: [strokeWidth, \"px\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 367,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 357,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 297,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 296,\n      columnNumber: 7\n    }, this), !showTools && /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: () => setShowTools(true),\n      className: \"fixed left-4 top-1/2 transform -translate-y-1/2 bg-white rounded-lg shadow-lg p-2 z-40\",\n      title: \"Show Drawing Tools\",\n      children: /*#__PURE__*/_jsxDEV(Palette, {\n        className: \"h-5 w-5\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 379,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 374,\n      columnNumber: 9\n    }, this), isDrawing && canvasRect && /*#__PURE__*/_jsxDEV(\"svg\", {\n      ref: svgRef,\n      className: \"fixed pointer-events-none z-30\",\n      style: {\n        left: canvasRect.left,\n        top: canvasRect.top,\n        width: canvasRect.width,\n        height: canvasRect.height\n      },\n      children: renderCurrentDrawing()\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 385,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true);\n};\n_s(DrawingTools, \"x96qNLUsB2qZRacF6kRmaRsVe54=\", false, function () {\n  return [useQueryClient, useMutation];\n});\n_c = DrawingTools;\nexport default DrawingTools;\nvar _c;\n$RefreshReg$(_c, \"DrawingTools\");","map":{"version":3,"names":["React","useState","useRef","useEffect","useCallback","useMutation","useQueryClient","drawingAPI","Pen","ArrowRight","Square","Circle","Minus","Palette","X","v4","uuidv4","toast","jsxDEV","_jsxDEV","Fragment","_Fragment","DrawingTools","pdfUuid","pageNumber","scale","isEnabled","onDrawingChange","pageContainerRef","_s","tool","setTool","color","setColor","strokeWidth","setStrokeWidth","isDrawing","setIsDrawing","currentPath","setCurrentPath","showTools","setShowTools","svgRef","queryClient","createDrawingMutation","create","onSuccess","invalidateQueries","success","onError","error","console","tools","id","icon","name","colors","getPageCanvas","current","pageContainer","querySelector","getRelativePosition","e","canvas","x","y","rect","getBoundingClientRect","clientX","left","width","clientY","top","height","Math","max","min","getAbsolutePosition","relativePos","handleMouseDown","preventDefault","stopPropagation","log","pos","handleMouseMove","prev","handleMouseUp","length","pathLength","validPath","drawingData","uuid","type","data","path","style","opacity","mutateAsync","preventSelection","addEventListener","document","cursor","removeEventListener","renderCurrentDrawing","pathData","slice","map","p","join","d","stroke","fill","strokeLinecap","strokeLinejoin","fileName","_jsxFileName","lineNumber","columnNumber","x1","y1","x2","y2","rectData","abs","radius","sqrt","pow","cx","cy","r","start","end","angle","atan2","arrowLength","arrowAngle","PI","children","cos","sin","canvasRect","className","onClick","toolItem","Icon","title","colorOption","backgroundColor","value","onChange","target","parseInt","ref","_c","$RefreshReg$"],"sources":["D:/pdf demo/frontend/src/components/DrawingTools.js"],"sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from 'react';\r\nimport { useMutation, useQueryClient } from 'react-query';\r\nimport { drawingAPI } from '../services/api';\r\nimport { Pen, ArrowRight, Square, Circle, Minus, Palette, X } from 'lucide-react';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst DrawingTools = ({ pdfUuid, pageNumber, scale, isEnabled, onDrawingChange, pageContainerRef }) => {\r\n  const [tool, setTool] = useState('freehand');\r\n  const [color, setColor] = useState('#ff0000');\r\n  const [strokeWidth, setStrokeWidth] = useState(2);\r\n  const [isDrawing, setIsDrawing] = useState(false);\r\n  const [currentPath, setCurrentPath] = useState([]);\r\n  const [showTools, setShowTools] = useState(true);\r\n  \r\n  const svgRef = useRef(null);\r\n  const queryClient = useQueryClient();\r\n\r\n  const createDrawingMutation = useMutation(drawingAPI.create, {\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries(['drawings', pdfUuid]);\r\n      toast.success('Drawing saved!');\r\n    },\r\n    onError: (error) => {\r\n      toast.error('Failed to save drawing');\r\n      console.error('Failed to save drawing:', error);\r\n    }\r\n  });\r\n\r\n  const tools = [\r\n    { id: 'freehand', icon: Pen, name: 'Freehand' },\r\n    { id: 'arrow', icon: ArrowRight, name: 'Arrow' },\r\n    { id: 'rectangle', icon: Square, name: 'Rectangle' },\r\n    { id: 'circle', icon: Circle, name: 'Circle' },\r\n    { id: 'line', icon: Minus, name: 'Line' }\r\n  ];\r\n\r\n  const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#000000'];\r\n\r\n  const getPageCanvas = useCallback(() => {\r\n    if (!pageContainerRef?.current) return null;\r\n    const pageContainer = pageContainerRef.current;\r\n    return pageContainer.querySelector('canvas');\r\n  }, [pageContainerRef]);\r\n\r\n  const getRelativePosition = useCallback((e) => {\r\n    const canvas = getPageCanvas();\r\n    if (!canvas) return { x: 0, y: 0 };\r\n    \r\n    const rect = canvas.getBoundingClientRect();\r\n    const x = (e.clientX - rect.left) / rect.width;\r\n    const y = (e.clientY - rect.top) / rect.height;\r\n    \r\n    // Clamp to valid range\r\n    return {\r\n      x: Math.max(0, Math.min(1, x)),\r\n      y: Math.max(0, Math.min(1, y))\r\n    };\r\n  }, [getPageCanvas]);\r\n\r\n  const getAbsolutePosition = useCallback((relativePos) => {\r\n    const canvas = getPageCanvas();\r\n    if (!canvas) return { x: 0, y: 0 };\r\n    \r\n    const rect = canvas.getBoundingClientRect();\r\n    return {\r\n      x: relativePos.x * rect.width,\r\n      y: relativePos.y * rect.height\r\n    };\r\n  }, [getPageCanvas]);\r\n\r\n  const handleMouseDown = useCallback((e) => {\r\n    if (!isEnabled) return;\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    \r\n    console.log('Mouse down - starting drawing');\r\n    setIsDrawing(true);\r\n    const pos = getRelativePosition(e);\r\n    setCurrentPath([pos]);\r\n  }, [isEnabled, getRelativePosition]);\r\n\r\n  const handleMouseMove = useCallback((e) => {\r\n    if (!isDrawing || !isEnabled) return;\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    \r\n    const pos = getRelativePosition(e);\r\n    \r\n    if (tool === 'freehand') {\r\n      setCurrentPath(prev => [...prev, pos]);\r\n    } else {\r\n      // For shapes, only keep start and current position\r\n      setCurrentPath(prev => [prev[0], pos]);\r\n    }\r\n  }, [isDrawing, isEnabled, tool, getRelativePosition]);\r\n\r\n  const handleMouseUp = useCallback(async (e) => {\r\n    if (!isDrawing || currentPath.length === 0) return;\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    \r\n    console.log('Mouse up - finishing drawing', { tool, pathLength: currentPath.length });\r\n    \r\n    // Validate path based on tool\r\n    let validPath = [...currentPath];\r\n    if (tool !== 'freehand' && validPath.length > 2) {\r\n      validPath = [validPath[0], validPath[validPath.length - 1]];\r\n    }\r\n    \r\n    if (validPath.length < 2) {\r\n      console.log('Path too short, canceling');\r\n      setIsDrawing(false);\r\n      setCurrentPath([]);\r\n      return;\r\n    }\r\n\r\n    const drawingData = {\r\n      uuid: uuidv4(),\r\n      pdfUuid,\r\n      pageNumber,\r\n      type: tool,\r\n      data: {\r\n        path: validPath,\r\n        scale\r\n      },\r\n      style: {\r\n        color,\r\n        strokeWidth,\r\n        opacity: 1\r\n      }\r\n    };\r\n\r\n    try {\r\n      console.log('Saving drawing:', drawingData);\r\n      await createDrawingMutation.mutateAsync(drawingData);\r\n      onDrawingChange && onDrawingChange(drawingData);\r\n    } catch (error) {\r\n      console.error('Failed to save drawing:', error);\r\n    }\r\n\r\n    setIsDrawing(false);\r\n    setCurrentPath([]);\r\n  }, [isDrawing, currentPath, tool, pdfUuid, pageNumber, scale, color, strokeWidth, createDrawingMutation, onDrawingChange]);\r\n\r\n  // Add event listeners\r\n  useEffect(() => {\r\n    if (!isEnabled) return;\r\n\r\n    const canvas = getPageCanvas();\r\n    if (!canvas) return;\r\n\r\n    console.log('Adding event listeners to canvas');\r\n    \r\n    // Prevent text selection while drawing\r\n    const preventSelection = (e) => e.preventDefault();\r\n    \r\n    canvas.addEventListener('mousedown', handleMouseDown);\r\n    canvas.addEventListener('mousemove', handleMouseMove);\r\n    canvas.addEventListener('mouseup', handleMouseUp);\r\n    canvas.addEventListener('selectstart', preventSelection);\r\n    \r\n    // Also listen on document for mouse up (in case user drags outside)\r\n    document.addEventListener('mouseup', handleMouseUp);\r\n    \r\n    canvas.style.cursor = 'crosshair';\r\n\r\n    return () => {\r\n      console.log('Removing event listeners');\r\n      canvas.removeEventListener('mousedown', handleMouseDown);\r\n      canvas.removeEventListener('mousemove', handleMouseMove);\r\n      canvas.removeEventListener('mouseup', handleMouseUp);\r\n      canvas.removeEventListener('selectstart', preventSelection);\r\n      document.removeEventListener('mouseup', handleMouseUp);\r\n      canvas.style.cursor = 'default';\r\n    };\r\n  }, [isEnabled, handleMouseDown, handleMouseMove, handleMouseUp, getPageCanvas]);\r\n\r\n  const renderCurrentDrawing = () => {\r\n    if (currentPath.length === 0) return null;\r\n\r\n    const canvas = getPageCanvas();\r\n    if (!canvas) return null;\r\n\r\n    const rect = canvas.getBoundingClientRect();\r\n\r\n    switch (tool) {\r\n      case 'freehand':\r\n        if (currentPath.length < 2) return null;\r\n        const pathData = `M ${currentPath[0].x * rect.width} ${currentPath[0].y * rect.height} ` +\r\n          currentPath.slice(1).map(p => `L ${p.x * rect.width} ${p.y * rect.height}`).join(' ');\r\n        return (\r\n          <path\r\n            d={pathData}\r\n            stroke={color}\r\n            strokeWidth={strokeWidth}\r\n            fill=\"none\"\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n          />\r\n        );\r\n      \r\n      case 'line':\r\n        if (currentPath.length < 2) return null;\r\n        return (\r\n          <line\r\n            x1={currentPath[0].x * rect.width}\r\n            y1={currentPath[0].y * rect.height}\r\n            x2={currentPath[1].x * rect.width}\r\n            y2={currentPath[1].y * rect.height}\r\n            stroke={color}\r\n            strokeWidth={strokeWidth}\r\n          />\r\n        );\r\n      \r\n      case 'rectangle':\r\n        if (currentPath.length < 2) return null;\r\n        const rectData = {\r\n          x: Math.min(currentPath[0].x, currentPath[1].x) * rect.width,\r\n          y: Math.min(currentPath[0].y, currentPath[1].y) * rect.height,\r\n          width: Math.abs(currentPath[1].x - currentPath[0].x) * rect.width,\r\n          height: Math.abs(currentPath[1].y - currentPath[0].y) * rect.height\r\n        };\r\n        return (\r\n          <rect\r\n            x={rectData.x}\r\n            y={rectData.y}\r\n            width={rectData.width}\r\n            height={rectData.height}\r\n            stroke={color}\r\n            strokeWidth={strokeWidth}\r\n            fill=\"none\"\r\n          />\r\n        );\r\n      \r\n      case 'circle':\r\n        if (currentPath.length < 2) return null;\r\n        const radius = Math.sqrt(\r\n          Math.pow((currentPath[1].x - currentPath[0].x) * rect.width, 2) +\r\n          Math.pow((currentPath[1].y - currentPath[0].y) * rect.height, 2)\r\n        );\r\n        return (\r\n          <circle\r\n            cx={currentPath[0].x * rect.width}\r\n            cy={currentPath[0].y * rect.height}\r\n            r={radius}\r\n            stroke={color}\r\n            strokeWidth={strokeWidth}\r\n            fill=\"none\"\r\n          />\r\n        );\r\n      \r\n      case 'arrow':\r\n        if (currentPath.length < 2) return null;\r\n        const start = currentPath[0];\r\n        const end = currentPath[1];\r\n        const angle = Math.atan2((end.y - start.y) * rect.height, (end.x - start.x) * rect.width);\r\n        const arrowLength = 15;\r\n        const arrowAngle = Math.PI / 6;\r\n        \r\n        return (\r\n          <g>\r\n            <line\r\n              x1={start.x * rect.width}\r\n              y1={start.y * rect.height}\r\n              x2={end.x * rect.width}\r\n              y2={end.y * rect.height}\r\n              stroke={color}\r\n              strokeWidth={strokeWidth}\r\n            />\r\n            <path\r\n              d={`M ${end.x * rect.width} ${end.y * rect.height} \r\n                  L ${end.x * rect.width - arrowLength * Math.cos(angle - arrowAngle)} ${end.y * rect.height - arrowLength * Math.sin(angle - arrowAngle)}\r\n                  M ${end.x * rect.width} ${end.y * rect.height}\r\n                  L ${end.x * rect.width - arrowLength * Math.cos(angle + arrowAngle)} ${end.y * rect.height - arrowLength * Math.sin(angle + arrowAngle)}`}\r\n              stroke={color}\r\n              strokeWidth={strokeWidth}\r\n              fill=\"none\"\r\n            />\r\n          </g>\r\n        );\r\n      \r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  if (!isEnabled) return null;\r\n\r\n  const canvas = getPageCanvas();\r\n  const canvasRect = canvas?.getBoundingClientRect();\r\n\r\n  return (\r\n    <>\r\n      {/* Tools Panel */}\r\n      <div className={`fixed left-4 top-1/2 transform -translate-y-1/2 bg-white rounded-lg shadow-lg p-4 z-40 transition-transform ${showTools ? '' : '-translate-x-full'}`}>\r\n        <div className=\"space-y-4\">\r\n          {/* Toggle Button */}\r\n          <div className=\"flex justify-between items-center\">\r\n            <h3 className=\"text-sm font-medium\">Drawing Tools</h3>\r\n            <button\r\n              onClick={() => setShowTools(false)}\r\n              className=\"p-1 hover:bg-gray-100 rounded\"\r\n            >\r\n              <X className=\"h-4 w-4\" />\r\n            </button>\r\n          </div>\r\n\r\n          {/* Tool Selection */}\r\n          <div className=\"space-y-2\">\r\n            <h4 className=\"text-xs font-medium text-gray-600\">Tools</h4>\r\n            <div className=\"grid grid-cols-2 gap-2\">\r\n              {tools.map((toolItem) => {\r\n                const Icon = toolItem.icon;\r\n                return (\r\n                  <button\r\n                    key={toolItem.id}\r\n                    onClick={() => setTool(toolItem.id)}\r\n                    className={`p-2 rounded border flex items-center justify-center ${\r\n                      tool === toolItem.id\r\n                        ? 'bg-blue-100 border-blue-500 text-blue-700'\r\n                        : 'border-gray-300 hover:bg-gray-50'\r\n                    }`}\r\n                    title={toolItem.name}\r\n                  >\r\n                    <Icon className=\"h-4 w-4\" />\r\n                  </button>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Color Selection */}\r\n          <div className=\"space-y-2\">\r\n            <h4 className=\"text-xs font-medium text-gray-600\">Color</h4>\r\n            <div className=\"flex flex-wrap gap-1\">\r\n              {colors.map((colorOption) => (\r\n                <button\r\n                  key={colorOption}\r\n                  onClick={() => setColor(colorOption)}\r\n                  className={`w-6 h-6 rounded border-2 ${\r\n                    color === colorOption ? 'border-gray-800' : 'border-gray-300'\r\n                  }`}\r\n                  style={{ backgroundColor: colorOption }}\r\n                />\r\n              ))}\r\n            </div>\r\n            <input\r\n              type=\"color\"\r\n              value={color}\r\n              onChange={(e) => setColor(e.target.value)}\r\n              className=\"w-full h-8 rounded border\"\r\n            />\r\n          </div>\r\n\r\n          {/* Stroke Width */}\r\n          <div className=\"space-y-2\">\r\n            <h4 className=\"text-xs font-medium text-gray-600\">Stroke Width</h4>\r\n            <input\r\n              type=\"range\"\r\n              min=\"1\"\r\n              max=\"10\"\r\n              value={strokeWidth}\r\n              onChange={(e) => setStrokeWidth(parseInt(e.target.value))}\r\n              className=\"w-full\"\r\n            />\r\n            <div className=\"text-xs text-gray-600\">{strokeWidth}px</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Show Tools Button (when hidden) */}\r\n      {!showTools && (\r\n        <button\r\n          onClick={() => setShowTools(true)}\r\n          className=\"fixed left-4 top-1/2 transform -translate-y-1/2 bg-white rounded-lg shadow-lg p-2 z-40\"\r\n          title=\"Show Drawing Tools\"\r\n        >\r\n          <Palette className=\"h-5 w-5\" />\r\n        </button>\r\n      )}\r\n\r\n      {/* Drawing Preview Overlay - positioned relative to canvas */}\r\n      {isDrawing && canvasRect && (\r\n        <svg\r\n          ref={svgRef}\r\n          className=\"fixed pointer-events-none z-30\"\r\n          style={{ \r\n            left: canvasRect.left,\r\n            top: canvasRect.top,\r\n            width: canvasRect.width,\r\n            height: canvasRect.height\r\n          }}\r\n        >\r\n          {renderCurrentDrawing()}\r\n        </svg>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default DrawingTools;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}